{% extends "layout.html" %} {% block title %} Equipment Details {% endblock %}
{% block content %}
<!-- Header -->
{% include 'partials/header.html' %}
<!-- Yeni Ä°Ã§erik (Ä°lk baÅŸta gizli olacak) -->
<div class="settings-content">
  <div class="orc-sidebar-set">
    <button class="tab-btn-set" data-target="wifi-set">Wi-fi Settings</button>
    <button class="tab-btn-set" data-target="lora-set" disabled>
      LoRa Settings
    </button>
    <button class="tab-btn-set" data-target="eth-set" disabled>
      Ethernet Settings
    </button>
    <button class="tab-btn-set" data-target="gsm-set" disabled>
      GSM Settingsead
    </button>
    <button class="tab-btn-set" data-target="orc-set">Router Settings</button>
  </div>

  <div class="content-area-set">
    <!-- Wi-Fi Set -->
    <div id="wifi-set" class="tab-content-set">
      <div class="wifi-container-set">
        <!-- Available Wi-Fi -->
        <div class="network-box-set">
          <div id="wifi-list" class="wifi-list-set">
            <h4 style="margin: 6px 0 5px 0px; padding: 0; padding: 0 20px">
              Available Wi-Fi
            </h4>
            <div class="available-wifi-underline"></div>
            <ul id="wifi-networks">
              <!-- Buraya dinamik Wi-Fi listesi gelecek -->
            </ul>
          </div>
        </div>

        <!-- Wi-Fi Password Form -->
        <div class="wifi-connection-set">
          <div class="wifi-card-set">
            <div class="wifi-icon-set">
              <img
                src="{{ url_for('static', filename='images/svg/12.svg') }}"
                alt="No Wi-Fi"
              />
              <h4>Wi-Fi Password</h4>
            </div>

            <p id="wifi-ssid">Wi-Fi SSID: <span>SeÃ§ilmedi</span></p>
            <div class="password-intput-set">
              <label>Password:</label>
              <input type="password" id="wifi-password" />
            </div>
            <div class="show-password-set">
              <input type="checkbox" id="showPass" class="check-box-set" />
              <label for="showPass" class="show-pass">Show Password</label>
            </div>
            <div class="btn-group-set">
              <button class="btn-set cancel-set">Cancel</button>
              <button class="btn-set connec-set" id="connect-btn">
                Connect
              </button>
            </div>
          </div>

          <!-- Connected Wi-Fi -->
          <div class="wifi-card-set connected">
            <h4>Connected</h4>
            <div class="underline"></div>
            <div class="wifi-info-set">
              <img
                src="{{ url_for('static', filename='images/svg/12.svg') }}"
                alt="No Wi-Fi"
              />
              <span id="connected-wifi">BaÄŸlÄ± deÄŸil</span>
              <button class="btn disconnect" id="disconnect-btn">
                Disconnect
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- LoRa Set -->
    <div id="lora-set" class="lora-settings-container" style="display: none">
      <div class="lora-settings-card">
        <h3>LoRa Settings</h3>
      </div>
    </div>

    <!-- Ethernet Set -->
    <div id="eth-set" class="eth-settings-container" style="display: none">
      <div class="eth-settings-card">
        <h3>Ethernet Settings</h3>
      </div>
    </div>

    <!-- GSM Set -->
    <div id="gsm-set" class="gsm-settings-container" style="display: none">
      <div class="gsm-settings-card">
        <h3>GSM Settings</h3>
      </div>
    </div>

    <!-- ORC Set -->
    <div id="orc-set" class="orc-settings-container" style="display: none">
      <div class="orc-settings-card">
        <div class="orc-input-group">
          <label>Modem Name</label>
          <input type="text" placeholder="Modem Name" />
        </div>

        <div class="orc-input-group">
          <label>Modem Status</label>
          <select>
            <option value="active">Active</option>
            <option value="inactive">Inactive</option>
          </select>
        </div>
        <div class="orc-input-group">
          <label>Query Update Time (Hour - Minute)</label>
          <select>
            <option value="">Select</option>
            <option value="00:30">00:30</option>
            <option value="01:00">01:00</option>
            <option value="01:30">01:30</option>
            <option value="02:00">02:00</option>
          </select>
        </div>
        <button class="orc-save-btn">Kaydet</button>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const tabButtons = document.querySelectorAll(".tab-btn-set");
      const tabContents = document.querySelectorAll(".content-area-set > div");
      tabButtons.forEach((button) => {
        button.addEventListener("click", function () {
          const targetId = this.getAttribute("data-target");

          tabContents.forEach((content) => (content.style.display = "none"));

          tabButtons.forEach((btn) => btn.classList.remove("active"));

          this.classList.add("active");

          const targetElement = document.getElementById(targetId);
          if (targetElement) {
            targetElement.style.display = "block";
          }
        });
      });

      if (tabButtons.length > 0) {
        tabButtons[0].click();
      }
    });

    document.addEventListener("DOMContentLoaded", function () {
      const wifiListElement = document.getElementById("wifi-networks");
      const wifiPasswordInput = document.getElementById("wifi-password");
      const wifiSSIDElement = document.getElementById("wifi-ssid").querySelector("span");
      const connectedWifiSpan = document.getElementById("connected-wifi");
      const connectButton = document.getElementById("connect-btn");
      const disconnectButton = document.getElementById("disconnect-btn");
      const showPasswordCheckbox = document.getElementById("showPass");
      let selectedSSID = null;
  
      // ðŸ“Œ Wi-Fi aÄŸlarÄ±nÄ± getir ve listele
      function fetchWifiNetworks() {
          fetch("/wi-fi-list", { method: "POST" })
              .then((response) => response.json())
              .then((data) => {
                  if (data.status !== "success") {
                      wifiListElement.innerHTML = `<p style='color: red;'>${data.message}</p>`;
                      return;
                  }
  
                  let networks = data.data.wifi_networks || [];
                  const connectedSSID = data.data.connected_ssid || null;
                  const connectedPassword = data.data.wifi_password || "";
  
                  let wifiHTML = "";
  
                  // ðŸ“Œ BaÄŸlÄ± Wi-Fi'yi en Ã¼ste taÅŸÄ±
                  if (connectedSSID) {
                      networks = networks.filter((ssid) => ssid !== connectedSSID);
                      networks.unshift(connectedSSID);
                  }
  
                  networks.forEach((ssid) => {
                      const isConnected = ssid === connectedSSID ? "wifi-connected" : "";
                      wifiHTML += `
                          <li onclick="selectWifi('${ssid}')" class="${isConnected}">
                              <img src="/static/images/svg/25.svg" alt="Wi-Fi"/>
                              <span>${ssid}</span>
                              <img src="/static/images/svg/26.svg" alt="Lock"/>
                          </li>
                      `;
                  });
  
                  wifiListElement.innerHTML = wifiHTML;
  
                  // ðŸ“Œ BaÄŸlÄ± Wi-Fi'yi gÃ¼ncelle
                  if (connectedSSID) {
                      selectedSSID = connectedSSID;
                      wifiSSIDElement.innerText = connectedSSID;
                      connectedWifiSpan.innerText = connectedSSID;
                      wifiPasswordInput.value = connectedPassword;
                  }
              })
              .catch((error) => {
                  console.error("Wi-Fi aÄŸlarÄ± yÃ¼klenirken hata oluÅŸtu:", error);
                  wifiListElement.innerHTML = "<p style='color: red;'>Wi-Fi bilgisi alÄ±namadÄ±.</p>";
              });
      }
  
      // ðŸ“Œ SeÃ§ilen Wi-Fi'yi inputa ekle
      window.selectWifi = function (ssid) {
          selectedSSID = ssid;
          wifiSSIDElement.innerText = ssid;
          wifiPasswordInput.value = "";
      };
  
      // ðŸ“Œ Åžifreyi gÃ¶ster/gizle
      showPasswordCheckbox.addEventListener("change", function () {
          wifiPasswordInput.type = this.checked ? "text" : "password";
      });
  
      // ðŸ“Œ Wi-Fi aÄŸÄ±na baÄŸlan
      connectButton.addEventListener("click", function () {
          if (!selectedSSID) {
              alert("LÃ¼tfen bir Wi-Fi aÄŸÄ± seÃ§in!");
              return;
          }
  
          const password = wifiPasswordInput.value;
          if (!password) {
              alert("LÃ¼tfen ÅŸifre girin!");
              return;
          }
  
          // ðŸ“Œ BaÄŸlantÄ±yÄ± baÅŸlat
          fetch("/connect_wifi", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ ssid: selectedSSID, password: password }),
          })
              .then((response) => response.json())
              .then((data) => {
                  if (data.status === "success") {
                      alert("Wi-Fi baÄŸlantÄ±sÄ± baÅŸarÄ±lÄ±!");
                      connectedWifiSpan.innerText = selectedSSID;
                      fetchWifiNetworks();
                  } else {
                      alert("BaÄŸlantÄ± baÅŸarÄ±sÄ±z: " + data.message);
                  }
              })
              .catch((error) => {
                  console.error("Wi-Fi baÄŸlantÄ±sÄ± sÄ±rasÄ±nda hata oluÅŸtu:", error);
                  alert("BaÄŸlantÄ± hatasÄ±!");
              });
      });
  
      fetchWifiNetworks();
  });
  
    
  </script>

  <style>
    .wifi-connected span {
      color: green;
      font-weight: bold;
    }
  </style>
  {% endblock %}
</div>
