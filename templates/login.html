{% extends 'layout.html' %} {% block title %} ORC 24 - Login - Pier MTTP {%
endblock %} {% block content %}
<!-- Virtual Keyboard -->
<div id="keyboard-container" class="simple-keyboard"></div>

<div class="container">
  <div class="login-header">
    <div class="line line-left"></div>
    <img
      src="{{ url_for('static', filename='images/logos/logo-01.webp') }}"
      alt="Pier MTTP Logo"
      class="logo"
    />
    <div class="line line-right"></div>
  </div>

  <!-- Login Form Wrapper -->
  <div class="login-wrapper">
    <div class="login-box">
      {% with messages = get_flashed_messages(with_categories=true) %} {% if
      messages %} {% for category, message in messages %}
      <div class="alert alert-{{ category }}">{{ message }}</div>
      {% endfor %} {% endif %} {% endwith %}

      <form method="POST" action="{{ url_for('login') }}">
        <div class="input-group">
          <span class="icon icon-left"
            ><img
              src="{{ url_for('static', filename='images/svg/22.svg') }}"
              alt="User"
              width="20"
              height="20"
          /></span>
          <input
            type="text"
            name="email"
            placeholder="{{ _('Email') }}"
            autocomplete="off"
            autocorrect="off"
            autocapitalize="none"
            spellcheck="false"
            required
          />
        </div>

        <div class="input-group">
          <span class="icon icon-left"
            ><img
              src="{{ url_for('static', filename='images/svg/21.svg') }}"
              alt="Lock"
              width="20"
              height="20"
          /></span>
          <input
            type="password"
            name="password"
            id="password-input"
            placeholder="{{ _('Password') }}"
            autocomplete="new-password"
            autocorrect="off"
            autocapitalize="none"
            spellcheck="false"
            required
          />
          <span class="icon icon-right" id="toggle-password">
            <span class="eye-divider"></span>
            <i class="fa-solid fa-eye"></i
          ></span>
        </div>

        <div class="login-actions">
          <button type="submit" class="login-btn">
            {{ _('Login') }}
            <img
              src="{{ url_for('static', filename='images/svg/36.svg') }}"
              alt="Login"
              width="30"
              height="30"
              style="padding: 7px 9px; background: #0b1734; border-radius: 5px"
            />
          </button>

          <!-- Dil seçici -->
          <div class="language-switcher fixed-top-right" id="languageSwitcher">
            <button type="button" class="language-toggle" id="languageToggle">
              <img src="{{ url_for('static', filename='images/svg/globe.svg') }}" width="24" height="24" alt="Globe Icon" />
            </button>
          
            <div class="language-dropdown" id="languageDropdown">
              <!-- Üçgen -->
              <div class="dropdown-arrow"></div>
          
              <!-- Seçenekler -->
              <button type="button" class="lang-btn {% if g.get('lang') == 'tr' %}selected{% endif %}" data-lang="tr" onclick="setLanguage('tr')">
                <span class="radio-indicator"></span>
                <img src="{{ url_for('static', filename='images/flags/tr.png') }}" width="20" /> TR
              </button>
              
              <button type="button" class="lang-btn {% if g.get('lang') == 'en' %}selected{% endif %}" data-lang="en" onclick="setLanguage('en')">
                <span class="radio-indicator"></span>
                <img src="{{ url_for('static', filename='images/flags/uk.png') }}" width="20" /> EN
              </button>
              
              <button type="button" class="lang-btn {% if g.get('lang') == 'de' %}selected{% endif %}" data-lang="de" onclick="setLanguage('de')">
                <span class="radio-indicator"></span>
                <img src="{{ url_for('static', filename='images/flags/de.png') }}" width="20" /> DE
              </button>
              
            </div>
          </div>
          
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  function setLanguage(lang) {
    // Seçili butonu işaretle (UI'da turuncu içli yuvarlak)
    document.querySelectorAll(".lang-btn").forEach(btn => {
      btn.classList.remove("selected");
    });
    const selectedBtn = document.querySelector(`.lang-btn[data-lang="${lang}"]`);
    if (selectedBtn) {
      selectedBtn.classList.add("selected");
    }

    // Sunucuya POST isteği gönder (dili değiştir)
    fetch("{{ url_for('set_language') }}", {
      method: "POST",
      headers: {
        "Content-Type": "application/x-www-form-urlencoded",
      },
      body: "lang=" + lang,
    }).then(() => {
      window.location.reload(); 
    });
  }
  document.addEventListener("DOMContentLoaded", function () {
    const toggle = document.getElementById("languageToggle");
    const switcher = document.getElementById("languageSwitcher");
  
    toggle.addEventListener("click", function (event) {
      event.stopPropagation();
      switcher.classList.toggle("active");
    });
  
    document.addEventListener("click", function (e) {
      if (!switcher.contains(e.target)) {
        switcher.classList.remove("active");
      }
    });
  
    // Aktif dili işaretle
    const selectedBtn = document.querySelector(`.lang-btn[data-lang="${lang}"]`);
    const activeBtn = document.querySelector(`.lang-btn[data-lang="${activeLang}"]`);
  
    if (activeBtn) {
      activeBtn.classList.add("selected");
    }
  });
  
</script>

{% endblock %}
