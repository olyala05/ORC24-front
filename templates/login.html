{% extends 'layout.html' %} {% block title %} ORC 24 - Login - Pier MTTP {%
endblock %} {% block content %}
<!-- Virtual Keyboard -->
<div id="keyboard-container" class="simple-keyboard"></div>

<div class="container">
  <div class="login-header">
    <div class="line line-left"></div>
    <img
      src="{{ url_for('static', filename='images/logos/logo-01.webp') }}"
      alt="Pier MTTP Logo"
      class="logo"
    />
    <div class="line line-right"></div>
  </div>

  <!-- Login Form Wrapper -->
  <div class="login-wrapper">
    <div class="login-box">
      {% with messages = get_flashed_messages(with_categories=true) %} {% if
      messages %} {% for category, message in messages %}
      <div class="alert alert-{{ category }}">{{ message }}</div>
      {% endfor %} {% endif %} {% endwith %}

      <form method="POST" action="{{ url_for('login') }}">
        <div class="input-group">
          <span class="icon icon-left"
            ><img
              src="{{ url_for('static', filename='images/svg/22.svg') }}"
              alt="User"
              width="20"
              height="20"
          /></span>
          <input
            type="text"
            name="email"
            placeholder="{{ _('Email') }}"
            autocomplete="off"
            autocorrect="off"
            autocapitalize="none"
            spellcheck="false"
            required
          />
        </div>

        <div class="input-group">
          <span class="icon icon-left"
            ><img
              src="{{ url_for('static', filename='images/svg/21.svg') }}"
              alt="Lock"
              width="20"
              height="20"
          /></span>
          <input
            type="password"
            name="password"
            id="password-input"
            placeholder="{{ _('Password') }}"
            autocomplete="new-password"
            autocorrect="off"
            autocapitalize="none"
            spellcheck="false"
            required
          />
          <span class="icon icon-right" id="toggle-password">
            <span class="eye-divider"></span>
            <i class="fa-solid fa-eye"></i
          ></span>
        </div>

        <div class="login-actions">
          <button type="submit" class="login-btn">
            {{ _('Login') }}
            <img
              src="{{ url_for('static', filename='images/svg/36.svg') }}"
              alt="Login"
              width="30"
              height="30"
              style="padding: 7px 9px; background: #0b1734; border-radius: 5px"
            />
          </button>

          <!-- Dil Seçici -->
          <div class="language-switcher fixed-top-right" id="languageSwitcher">
            <button type="button" class="language-toggle" id="languageToggle">
              <img
                src="{{ url_for('static', filename='images/svg/globe.svg') }}"
                width="24"
                height="24"
                alt="Globe Icon"
              />
              <span class="selected-lang-txt" id="selectedLangLabel">
                {{ g.lang.upper() }}
              </span>
            </button>

            <div class="language-dropdown" id="languageDropdown">
              <div class="dropdown-arrow"></div>

              <!-- Türkçe -->
              <button
                type="button"
                class="lang-btn {% if g.get('lang') == 'tr' %}selected{% endif %}"
                data-lang="tr"
                onclick="setLanguage('tr')"
              >
                <div class="lang-content">
                  <img
                    src="{{ url_for('static', filename='images/flags/tr.png') }}"
                    width="20"
                  />
                  <span>TR</span>
                </div>

                <div class="radio-indicator-cover">
                <span class="radio-indicator"></span>

                </div>
              </button>

              <!-- English -->
              <button
                type="button"
                class="lang-btn {% if g.get('lang') == 'en' %}selected{% endif %}"
                data-lang="en"
                onclick="setLanguage('en')"
              >
                <div class="lang-content">
                  <img
                    src="{{ url_for('static', filename='images/flags/uk.png') }}"
                    width="20"
                  />
                  <span>EN</span>
                </div>
                <div class="radio-indicator-cover">
                <span class="radio-indicator"></span>
              </button>

              <!-- Deutsch -->
              <button
                type="button"
                class="lang-btn {% if g.get('lang') == 'de' %}selected{% endif %}"
                data-lang="de"
                onclick="setLanguage('de')"
              >
                <div class="lang-content">
                  <img
                    src="{{ url_for('static', filename='images/flags/de.png') }}"
                    width="20"
                  />
                  <span>DE</span>
                </div>
                <div class="radio-indicator-cover">
                <span class="radio-indicator"></span>
              </button>
            </div>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Sayfa yüklendiğinde aktif dilin gösterilmesini sağla
    const lang = "{{ g.get('lang', 'EN') }}"; // Flask'tan alınan aktif dil
    const selectedLangLabel = document.getElementById("selectedLangLabel");

    // Globe üzerindeki dil kodunu güncelle
    if (selectedLangLabel) {
      selectedLangLabel.innerText = lang.toUpperCase(); // Globe üzerindeki dil kodunu güncelle
      console.log(
        "Globe üzerindeki dil kodu (sayfa yüklendi):",
        lang.toUpperCase()
      ); // Log ekledik
    }

    // Dil seçeneği değiştirildiğinde çalışan fonksiyon
    function setLanguage(lang) {
      console.log("Dil değiştiriliyor:", lang); // Dil değişikliği yapılmadan önce log

      // Tüm dil butonlarından selected sınıfını kaldır
      document
        .querySelectorAll(".lang-btn")
        .forEach((btn) => btn.classList.remove("selected"));

      // Seçilen dil butonuna selected sınıfını ekle
      const selectedBtn = document.querySelector(
        `.lang-btn[data-lang="${lang}"]`
      );
      if (selectedBtn) {
        selectedBtn.classList.add("selected");
      }

      // Globe yanındaki TR / EN / DE yazısını güncelle
      if (selectedLangLabel) {
        selectedLangLabel.innerText = lang.toUpperCase(); // Globe üzerindeki dil kodunu değiştir
      }

      // Backend dil güncellemesi yap
      fetch("{{ url_for('set_language') }}", {
        method: "POST",
        headers: {
          "Content-Type": "application/x-www-form-urlencoded",
        },
        body: "lang=" + lang,
      }).then(() => {
        console.log("Backend'e gönderilen dil:", lang); // Dil backend'e gönderildiğini logla
        window.location.reload(); // Yeni dilin yüklendiği halini göster
      });
    }

    // Dil butonlarına tıklandığında setLanguage fonksiyonunu çalıştır
    document.querySelectorAll(".lang-btn").forEach((button) => {
      button.addEventListener("click", function () {
        const lang = button.getAttribute("data-lang");
        setLanguage(lang); // Seçilen dil ile setLanguage fonksiyonunu çağır
      });
    });

    // Dil seçici butonunun tıklama olayı
    const toggle = document.getElementById("languageToggle");
    const switcher = document.getElementById("languageSwitcher");

    toggle.addEventListener("click", function (event) {
      event.stopPropagation();
      switcher.classList.toggle("active");
    });

    document.addEventListener("click", function (e) {
      if (!switcher.contains(e.target)) {
        switcher.classList.remove("active");
      }
    });
  });
</script>

{% endblock %}
