{% extends "layout.html" %} 

{% block title %} Modem Selection {% endblock %} 

{% block content %}

<div class="header">
  <div class="header-left">
    <form action="{{ url_for('auth.logout') }}" method="POST" id="logout-form">
      <button type="button" class="header-button-logout" id="logout-button">
        <img
          src="{{ url_for('static', filename='images/svg/37.svg') }}"
          alt="Logout"
          width="40"
          height="40"
          style="padding: 0px 0px; border-radius: 5px"
        />
      </button>
    </form>
    <!-- Home Butonu -->
    <button class="header-button" onclick="goToDashboard()">
      {{ _('Home')}}
      <img
        src="{{ url_for('static', filename='images/svg/19.svg') }}"
        alt="Logout"
        width="30"
        height="30"
        style="padding: 9px 9px; background: #0b1734; border-radius: 5px"
      />
    </button>

    <!-- Alarm icon Şimdilik Alarm yorum satırında  -->

    <!--     
          <div class="alarm-icon-container">
        <button class="alarm-button" onclick="goToAlarm()" title="Alarm">
          <img
            src="{{ url_for('static', filename='images/svg/32.svg') }}"
            alt="Alarm"
            width="32"
            height="32"
          />
        </button>
        <span id="alarm-count" class="alarm-badge" display="none">0</span>
      </div> 
    -->


  </div>

  <div class="header-logo">
    <img
      src="{{ url_for('static', filename='images/logos/logo-01.webp') }}"
      alt="Pier MTTP Logo"
      class="logo"
    />
  </div>

  <div class="header-right">
    <div class="date-time" id="currentDateTime"></div>
    <div class="report-line">
      <div class="line"></div>
    </div>
    <div class="report-date">{{ _('Modem Selection') }}</div>
  </div>
</div>

<!-- Sayfa İçeriği -->
<main class="content">
  <div class="modem-selection">
    <!-- Modem Dropdown -->
    <div class="dropdown-container">
      <div class="modem-dropdown-wrapper" style="position: relative">
        <img
          id="modem-icon"
          src="{{ url_for('static', filename='images/svg/40.svg') }}"
          alt="Modems"
          class="modem-dropdown-icon"
        />

        <select id="modem" class="modem-dropdown" onchange="connectDevice()">
          <option value="" disabled selected>
            <span id="loadingText">
              {{ _('Loading') }}<span class="dots"></span>
            </span>
          </option>
        </select>

        <!-- Ok ikonları -->
        <img
          id="arrow-icon"
          class="arrow-icon"
          src="{{ url_for('static', filename='images/svg/down-arrow.svg') }}"
          alt="Arrow"
          width="16"
          height="16"
          style="
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
          "
        />
      </div>
    </div>

    <div class="button-container">
      <button id="orcStatusBtn" class="btn" onclick="goToORCStatus()" disabled>
        {{ _('ORC Status') }}
      </button>
      <button id="equipmentBtn" class="btn" onclick="goToEquipment()" disabled>
        {{ _('Equipment') }}
      </button>
      <button id="settingBtn" class="btn" onclick="goToSetting()" disabled>
        {{ _('Settings') }}
      </button>
    </div>

    <div class="bottom-buttons">
      <button id="testBtn" class="btn" onclick="SwitchtTest()"{% if user_role == 'technical' %} disabled  {% endif %}>
          {{ _('Test') }}
      </button>

      <button id="dataBtn" class="btn" onclick="goToData()" disabled>
        {{ _('Data') }}
      </button>
    </div>

    <div id="status"></div>
  </div>
</main>
<!-- Select2 -->
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='select2-develop/css/select2.min.css') }}"
/>
<!-- Javascript Kodu -->
<script src="{{ url_for('static', filename='select2-develop/js/select2.min.js') }}"></script>

<!-- Choises  -->
<script src="{{ url_for('static', filename='js/choices.min.js') }}"></script>

<!-- jQuery (select2 için gerekli) -->
<script src="{{ url_for('static', filename='js/jquery-3.6.0.min.js') }}"></script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    document
      .getElementById("logout-button")
      .addEventListener("click", function (event) {
        event.preventDefault();

        Swal.fire({
          title: "{{ _('Are you sure you want to log out?') }}",
          icon: "warning",
          background: "#0B1734",
          iconColor: "#EF8018",
          showCancelButton: true,
          confirmButtonText: "{{ _('Yes') }}",
          cancelButtonText: "{{ _('No') }}",
          reverseButtons: false,
          customClass: {
            confirmButton: "swal-button-yes",
            cancelButton: "swal-button-no",
          },
          buttonsStyling: false,
        }).then((result) => {
          if (result.isConfirmed) {
            document.getElementById("logout-form").submit();
          }
        });
      });
  });

  // Sayfa yüklendiğinde cihazları getir
  document.addEventListener("DOMContentLoaded", fetchDevices);

  // Dashboard Sayfasına Yönlendirir
  function goToDashboard() {
    window.location.href = "/dashboard";
  }

  // Active butonu seçme
  document.addEventListener("DOMContentLoaded", function () {
    // Tüm butonları seç
    let buttons = document.querySelectorAll(
      ".button-container .btn, .bottom-buttons .btn"
    );

    buttons.forEach((button) => {
      button.addEventListener("click", function () {
        // Önce tüm butonlardan `active` sınıfını kaldır
        buttons.forEach((btn) => btn.classList.remove("active"));

        // Tıklanan butona `active` sınıfını ekle
        this.classList.add("active");
      });
    });
  });

  function fetchDevices() {
    let dropdown = document.getElementById("modem");
    let modemIcon = document.getElementById("modem-icon");
    let arrowIcon = document.getElementById("arrow-icon");

    let defaultOption = dropdown.querySelector("option");
    defaultOption.textContent = `{{ _('Loading') }}`;

    let dotCount = 0;
    let loadingInterval = setInterval(() => {
      dotCount = (dotCount + 1) % 4;
      defaultOption.textContent = `{{ _('Loading') }}` + ".".repeat(dotCount);
    }, 400);

    modemIcon.src = "{{ url_for('static', filename='images/svg/40.svg') }}";

    fetch("/devices")
      .then((response) => response.json())
      .then((data) => {
        clearInterval(loadingInterval);

        dropdown.innerHTML = "";

        let newDefaultOption = document.createElement("option");
        newDefaultOption.value = "";
        newDefaultOption.disabled = true;
        newDefaultOption.selected = true;
        newDefaultOption.textContent = "{{ _('Select Modem') }}";
        dropdown.appendChild(newDefaultOption);

        data.forEach((device) => {
          let option = document.createElement("option");
          option.value = device.ip;
          option.setAttribute("data-name", device.name);
          option.setAttribute("data-mac", device.mac);
          option.setAttribute("data-ip", device.ip);
          option.textContent = device.name;
          dropdown.appendChild(option);
        });

        // YÜKLEME BİTTİ → Seçim yapılmadan önce 40.svg göster
        modemIcon.src = "{{ url_for('static', filename='images/svg/40.svg') }}";

        // Select2'yi başlat
        $(dropdown).select2({
          templateResult: formatOption,
          templateSelection: formatSelection,
          dropdownParent: $(".modem-dropdown-wrapper"), // Gerekirse
        });

        // AÇILDIĞINDA: koyu mavi yap
        $(dropdown).on("select2:open", function () {
          arrowIcon.src =
            "{{ url_for('static', filename='images/svg/up-arrow.svg') }}";
          modemIcon.src =
            "{{ url_for('static', filename='images/svg/38.svg') }}";
          $(".modem-dropdown-wrapper").addClass("open");
        });

        // KAPANDIĞINDA: tekrar beyaz yap
        $(dropdown).on("select2:close", function () {
          arrowIcon.src =
            "{{ url_for('static', filename='images/svg/down-arrow.svg') }}";
          modemIcon.src =
            "{{ url_for('static', filename='images/svg/40.svg') }}";
          $(".modem-dropdown-wrapper").removeClass("open");
        });

        toggleButtons(true);
      })
      .catch((error) => {
        clearInterval(loadingInterval); // hata olsa bile animasyonu durdur
        console.error("{{ _('Error while retrieving devices:')}}", error);
        toggleButtons(false);
      });
  }

  // Butonları etkinleştir veya devre dışı bırak
  function toggleButtons(enable) {
    const buttons = [
      "orcStatusBtn",
      "equipmentBtn",
      "settingBtn",
      "testBtn",
      "dataBtn",
    ];

    buttons.forEach((buttonId) => {
      let button = document.getElementById(buttonId);
      if (button) {
        button.disabled = !enable;
      }
    });
  }

  // Custom Template for Option
  function formatOption(option) {
    if (!option.id) return option.text;

    // Ana wrapper
    const $option = $("<div class='select2-custom-option'></div>");

    // Modem adı - üstte ve mavi
    const name = $("<div class='modem-name'></div>").text(
      $(option.element).data("name")
    );

    // MAC (turuncu) ve IP (mavi) - yanyana
    const infoRow = $("<div class='info-row'></div>");
    const mac = $("<span class='mac-address'></span>").text(
      $(option.element).data("mac")
    );
    const ip = $("<span class='ip-address'></span>").text(
      $(option.element).data("ip")
    );

    infoRow.append(mac).append(" ").append(ip);

    // Hepsini birleştir
    $option.append(name).append(infoRow);

    return $option;
  }

  // Custom Template for Selected Item
  function formatSelection(option) {
    return option.text;
  }

  // Sayfa yüklendiğinde fetchDevices fonksiyonunu çağırıyoruz
  document.addEventListener("DOMContentLoaded", fetchDevices);

  // ORC Status
  function goToORCStatus() {
    let dropdown = document.getElementById("modem");
    let selectedDeviceIP = dropdown ? dropdown.value : null;
    if (!selectedDeviceIP) {
      showWarningAlert("{{ _('Please select a device first!') }}");
      return;
    }
    showLoading("{{ _('ORC Status is loading...') }}");
    window.location.href = `/orc-status?ip_address=${selectedDeviceIP}`;
    window.addEventListener("pageshow", function () {
      hideLoading();
    });
  }

  // Equipment With Model
  function goToEquipment() {
    let dropdown = document.getElementById("modem");
    let selectedDeviceIP = dropdown ? dropdown.value : null;
    if (!selectedDeviceIP) {
      showWarningAlert("{{ _('Please select a device first!') }}");
      return;
    }
    showLoading("{{ _('Equipments are loading...') }}");
    fetch("/equipments-with-models", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ ip_address: selectedDeviceIP }),
    })
      .then((response) => response.json())
      .then((data) => {
        if (!data || data.error) {
          showErrorAlert(
            "{{ _('Error!') }}",
            data.error || "{{ _('Equipment data could not be retrieved.')}}"
          );
          return;
        }

        sessionStorage.setItem("equipment_data", JSON.stringify(data.data));
        window.location.href = "/equipment";
      })
      .catch((error) => {
        showErrorAlert(
          "{{ _('Error!') }}",
          "{{ _('Equipment data could not be retrieved. Please try again.')}}"
        );
      })
      .finally(() => {
        hideLoading();
      });
  }

  // Setting
  function goToSetting() {
    let dropdown = document.getElementById("modem");
    let selectedDeviceIP = dropdown ? dropdown.value : null;

    if (!selectedDeviceIP) {
      showWarningAlert("{{ _('Please select a device first!') }}");
      return;
    }

    showLoading("{{ _('Settings are loading...') }}");

    window.location.href = "/settings";
  }

  // Test Sayfasına Yönlendirir
  function SwitchtTest() {
    const userRole = document.body.dataset.userRole;
    const dropdown = document.getElementById("modem");
    const selectedDeviceIP = dropdown ? dropdown.value : null;

    // 2️⃣ Cihaz Seçimi Kontrolü
    if (!selectedDeviceIP) {
        showWarningAlert("{{ _('Please select a device first!') }}");
        return;
    }

    // 1️⃣ Role Kontrolü
    if (userRole === 'technical') {
        showErrorAlert("Bu sayfaya erişim izniniz bulunmamaktadır.");
        return;
    }

    // 3️⃣ Yönlendirme
    showLoading("{{ _('Test is loading...') }}");
    setTimeout(() => {
        window.location.href = "/switch";
    }, 100);
  }

  // data
  function goToData() {
    let dropdown = document.getElementById("modem");
    let selectedDeviceIP = dropdown ? dropdown.value : null;
    if (!selectedDeviceIP) {
      showWarningAlert("{{ _('Please select a device first!') }}");
      return;
    }
    showLoading("{{ _('Data is loading...') }}");
    window.location.href = "/data";
  }

  // Equipment Setting
  function goToEquipmentSetting() {
    let dropdown = document.getElementById("modem");
    let selectedDeviceIP = dropdown ? dropdown.value : null;

    if (!selectedDeviceIP) {
      showWarningAlert("{{ _('Please select a device first!') }}");
      return;
    }
    showLoading("{{ _('Equipments are being scanned...') }}");
    fetch("/modbus_request", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({ ip_address: selectedDeviceIP }),
    })
      .then((response) => response.json())
      .then((data) => {
        if (data.error) {
          showErrorAlert("{{ _('Error!') }}", data.error);
          return;
        }
        sessionStorage.setItem("modbus_data", JSON.stringify(data.modbus_data));
        window.location.href = "/equipment-setting";
      })
      .catch((error) => {
        showErrorAlert(
          "{{ _('An error occurred while retrieving Modbus data:') }}" + error
        );
      })
      .finally(() => {
        hideLoading();
      });
  }

  function updateDateTime() {
    const now = new Date();

    // Gün, ay, yıl formatında al (DD Month YYYY)
    const options = { day: "2-digit", month: "long", year: "numeric" };
    const formattedDate = now.toLocaleDateString("tr-TR", options);

    // Saat ve dakikayı ekle (HH:MM formatında)
    const formattedTime = now.toLocaleTimeString("tr-TR", {
      hour: "2-digit",
      minute: "2-digit",
    });

    // HTML içine ekle
    document.getElementById(
      "currentDateTime"
    ).textContent = `${formattedDate} ${formattedTime}`;
  }

  updateDateTime();

  setInterval(updateDateTime, 60000);

  window.addEventListener("pageshow", function (event) {
    let loader = document.getElementById("loading-overlay");
    if (loader) {
      loader.remove();
    }
  });

  // Alarm Sayfasına Yönlendirir
  function goToAlarm() {
    let dropdown = document.getElementById("modem");
    let selectedDeviceIP = dropdown ? dropdown.value : null;
    if (!selectedDeviceIP) {
      showSuccessAlert("{{ _('Please select a device first!') }}");
      return;
    }
    showLoading("{{ _('Redirecting to the alarm page...') }}");
    fetch("/get_selected_device")
      .then((response) => response.json())
      .then((data) => {
        if (!data.ip_address) {
          showWarningAlert("{{ _('Please select a device first!') }}");
          return;
        }
        window.location.href = `/alarm?ip_address=${data.ip_address}`;
      })
      .catch((error) => {
        console.error("Cihaz seçme hatası:", error);
        showErrorAlert(
          "{{ _('Error!') }}",
          "{{ _('Device information could not be retrieved. Please try again.') }}"
        );
      })
      .finally(() => {
        hideLoading();
      });
  }

  // AbortController değişkenleri (İlk başta boş)
  let networkAlarmController = new AbortController();
  let electricAlarmController = new AbortController();
  let alarmUpdateInterval = null;

  function updateAlarmCount() {
    let selectedDeviceIP = sessionStorage.getItem("selected_device_ip");
    let alarmBadge = document.getElementById("alarm-count");

    //  Eğer cihaz seçili değilse API çağrılarını durdur ve alarmı sıfırla
    if (!selectedDeviceIP || selectedDeviceIP.trim() === "") {
      console.warn("Cihaz seçili değil, alarm sıfırlandı!");

      // Eski istekleri iptal et
      networkAlarmController.abort();
      electricAlarmController.abort();

      // Yeni istekler için yeni AbortController oluştur
      networkAlarmController = new AbortController();
      electricAlarmController = new AbortController();

      // Interval çalışıyorsa durdur
      if (alarmUpdateInterval) {
        clearInterval(alarmUpdateInterval);
        alarmUpdateInterval = null;
      }

      localStorage.removeItem("last_alarm_count");
      alarmBadge.textContent = "0";
      alarmBadge.style.display = "inline-block";
      return;
    }

    console.log("Seçili cihaz:", selectedDeviceIP);

    let totalAlarms = 0;
    let errorOccurred = false;

    // **Network Alarmlarını Çek**
    fetch(`/get_network_alarm_data?ip=${selectedDeviceIP}`, {
      signal: networkAlarmController.signal,
    })
      .then((response) => response.json())
      .then((data) => {
        if (data.status === "success") {
          totalAlarms += data.data.length;
        } else {
          console.error("Network alarm verisi alınamadı:", data.message);
          errorOccurred = true;
        }
        return fetch(`/get_electric_alarm_data?ip=${selectedDeviceIP}`, {
          signal: electricAlarmController.signal,
        });
      })
      .then((response) => response.json())
      .then((data) => {
        if (data.status === "success") {
          totalAlarms += data.data.length;
        } else {
          console.error("Electric alarm verisi alınamadı:", data.message);
          errorOccurred = true;
        }

        //  Eğer hata olduysa alarm sayısını sıfırla
        if (errorOccurred) {
          console.warn("Hata oluştuğu için alarm sıfırlandı.");
          totalAlarms = 0;
        }

        //  Alarm değerini göster
        alarmBadge.textContent = totalAlarms;
        alarmBadge.style.display = "inline-block";

        //  Yeni alarm değerini localStorage'a kaydet
        localStorage.setItem("last_alarm_count", totalAlarms);
      })
      .catch((error) => {
        if (error.name === "AbortError") {
          console.warn("{{ _('The alarm data request has been canceled.')}}");
        } else {
          console.error(
            "{{ _('Alarm data could not be retrieved for the selected device:') }}",
            error
          );
        }
        alarmBadge.textContent = "0";
        alarmBadge.style.display = "inline-block";
      });
  }

  // Cihaz Seçme Fonksiyonu
  function connectDevice() {
    let dropdown = document.getElementById("modem");
    let selectedDevice = dropdown.value;
    let selectedOption = dropdown.options[dropdown.selectedIndex];
    let modemName = selectedOption.getAttribute("data-name");

    if (!selectedDevice || selectedDevice.trim() === "") {
      showWarningAlert("{{ _('Please select a device first!') }}");
      setButtonsDisabled(true);
      return;
    }

    showLoading("{{ _('Connecting to the device , please wait...') }}");

    fetch("/connect_device", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ ip_address: selectedDevice }),
    })
      .then((response) => response.json())
      .then((data) => {
        if (data.success) {
          showSuccessAlert("{{ _('Successfully connected to the device!') }}");
          sessionStorage.setItem("selected_device_ip", selectedDevice);
          sessionStorage.setItem("selected_device_name", modemName);
          setButtonsDisabled(false);
        } else {
          showErrorAlert("{{ _('Failed to connect to the device!') }}");
          sessionStorage.removeItem("selected_device_ip");
          sessionStorage.removeItem("selected_device_name");
          setButtonsDisabled(true);
        }
      })
      .catch((error) => {
        showErrorAlert("{{ _('Connection Error') }}");
        sessionStorage.removeItem("selected_device_ip");
        sessionStorage.removeItem("selected_device_name");
        setButtonsDisabled(true);
      })
      .finally(() => {
        hideLoading();
      });
  }

  // Sayfa Yüklendiğinde Çalıştır
  document.addEventListener("DOMContentLoaded", function () {
    let selectedDeviceIP = sessionStorage.getItem("selected_device_ip");
    let alarmBadge = document.getElementById("alarm-count");

    if (!selectedDeviceIP) {
      console.warn(
        "{{ _('The page has been refreshed, no device found, alarm reset!') }}"
      );

      networkAlarmController.abort();
      electricAlarmController.abort();

      networkAlarmController = new AbortController();
      electricAlarmController = new AbortController();

      localStorage.removeItem("last_alarm_count");

      alarmBadge.textContent = "0";
      alarmBadge.style.display = "inline-block";
    } else {
      updateAlarmCount();
    }
  });

  function setButtonsDisabled(isDisabled) {
    let buttons = document.querySelectorAll(
      ".button-container .btn, .bottom-buttons .btn"
    );
    buttons.forEach((btn) => (btn.disabled = isDisabled));
  }

  document.addEventListener("DOMContentLoaded", () => {
    setButtonsDisabled(true);
  });
</script>

<style>

  /* === Select2 Stilleri === */
  .select2-container--default .select2-selection--single {
    border: 1px solid #aaa;
    border-radius: 4px;
    height: 51px;
    text-align: start;
    padding-left: 47px;
    padding-top: 12px;
    background-color: white;
    color: #1c2747;
    transition: background-color 0.3s ease;
  }

  .select2-container--default
    .select2-selection--single
    .select2-selection__rendered {
    font-weight: 700;
    font-size: 18px;
    line-height: 28px;
    color: #1c2747;
  }

  .modem-dropdown-wrapper.open
    .select2-container--default
    .select2-selection--single {
    background-color: #1c2747;
  }

  .modem-dropdown-wrapper.open .select2-selection__rendered {
    color: white !important;
  }

  /* Select2 ok işaretini gizle */
  .select2-container--default
    .select2-selection--single
    .select2-selection__arrow
    b {
    display: none !important;
  }

  /* Select2 seçenek hover */
  .select2-container--default
    .select2-results__option--highlighted.select2-results__option--selectable {
    background-color: #e2e2e2 !important;
    color: #1b2746;
  }

  .select2-results__option--selectable {
    cursor: pointer;
    color: #1b2746;
  }

  .select2-search__field {
    display: none !important;
  }

  /* === Dropdown & Ok === */
  .modem-dropdown-wrapper {
    position: relative;
    display: inline-block;
    background-color: white;
    border: 1px solid #ccc;
    border-radius: 6px;
    transition: background-color 0.3s ease;
  }

  .modem-dropdown-wrapper.open {
    background-color: #1c2747;
  }

  .arrow-icon {
    position: absolute;
    right: 16px;
    top: 54%;
    transform: translateY(-50%);
    pointer-events: none;
    width: 28px;
    height: 28px;
  }

  .modem-dropdown-icon {
    position: absolute;
    top: 50%;
    left: 10px;
    transform: translateY(-50%);
    width: 28px;
    height: 28px;
    border-radius: 5px;
    padding: 5px;
    pointer-events: none;
    z-index: 1;
  }

  .modem-dropdown option {
    padding: 10px;
    font-size: 14px;
    line-height: 1.5;
    display: flex;
    flex-direction: column;
  }

  .modem-dropdown {
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    background: none;
    padding-right: 10px;
    border: 1px solid #ccc;
  }

  /* === Select2 özel görünüm (modem adı, IP, MAC) === */
  .select2-custom-option {
    display: flex;
    flex-direction: column;
  }

  .modem-name {
    font-weight: 500;
    color: #1b2746;
    font-size: 18px;
    margin-bottom: 2px;
  }

  .info-row {
    display: flex;
    gap: 8px;
    font-size: 16px;
    margin-top: 2px;
  }

  .mac-address {
    color: #ec7427;
  }

  .ip-address {
    color: #6384d1;
  }

  /* === SweetAlert2 (swal) ve Toast === */
  .swal2-popup {
    border-radius: 8px;
    box-shadow: 0 2px 15px rgba(0, 0, 0, 0.2);
  }

  div:where(.swal2-container) div:where(.swal2-popup) {
    width: 28em;
  }

  div:where(.swal2-container) h2:where(.swal2-title) {
    padding: 0.1em 0;
    font-size: 16px;
    font-weight: 500;
    color: #ffffff;
  }

  div:where(.swal2-icon) {
    width: 4em;
    height: 4em;
    margin: 0.8em auto 0.6em;
  }

  div:where(.swal2-container) div:where(.swal2-actions) {
    margin: 0.25em auto 0;
    display: flex;
    justify-content: space-between;
    width: 94%;
  }

  .swal2-confirm,
  .swal2-cancel {
    width: 48%;
  }

  .swal-button-yes,
  .swal-button-no {
    background-color: #fff;
    color: #0b1734;
    border-radius: 5px;
    padding: 17px 19px;
    font-size: 16px;
    border: none;
  }

  .swal-button-no {
    border: 2px solid #0b1734;
  }


  @keyframes toast-in {
    0% {
      opacity: 0;
      transform: translateY(-20px);
    }
    100% {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes toast-out {
    0% {
      opacity: 1;
      transform: translateY(0);
    }
    100% {
      opacity: 0;
      transform: translateY(20px);
    }
  }

  
  /* Background for overlay */
  div:where(.swal2-container).swal2-backdrop-show,
  div:where(.swal2-container).swal2-noanimation {
    background: rgba(0, 0, 0, 0.4);
  }

  div:where(.swal2-container).swal2-center > .swal2-popup {
    grid-column: 2;
    grid-row: 2;
    place-self: center center;
    margin-top: 64px;
  }

  body.swal2-shown {
    padding-right: 0 !important;
    overflow: hidden !important;
  }

  .header,
  .fixed-element {
    transform: none !important;
    will-change: auto !important;
  }
</style>

{% endblock %}
