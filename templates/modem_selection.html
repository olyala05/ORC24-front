{% extends "layout.html" %} {% block title %} Modem Selection {% endblock %} {%
block content %}
<div class="header">
  <div class="header-left">
    <button class="header-button" onclick="goToDashboard()">Home <i class="fas fa-home"></i></button>
  </div>

  <div class="header-logo">
    <img
      src="{{ url_for('static', filename='images/logos/logo-01.webp') }}"
      alt="Pier MTTP Logo"
      class="logo"
    />
  </div>

  <div class="header-right">
    <div class="date-time">16 Temmuz 2024 10:14</div>
    <div class="report-line">
      <div class="line"></div>
    </div>
    <div class="report-date">Modem Selection</div>
  </div>
</div>

<!-- Sayfa Ä°Ã§eriÄŸi -->
<main class="content">
  <div class="modem-selection">
    <div class="dropdown-container">
      <label for="modem">Select Modem or Device:</label>
      <select id="modem" class="modem-dropdown" onchange="connectDevice()">
        <option value="" disabled selected>Loading devices...</option>
      </select>
    </div>

    <div class="button-container">
      <button class="btn active" onclick="goToORCStatus()">ORC Status</button>
      <button class="btn">Equipment</button>
      <button class="btn">Settings</button>
    </div>

    <div class="bottom-buttons">
      <button class="btn">Test</button>
      <button class="btn">Date</button>
    </div>

    <div id="status"></div>
  </div>
</main>

<script>
  function fetchDevices() {
    fetch("/devices")
      .then((response) => response.json())
      .then((data) => {
        let dropdown = document.getElementById("modem");
        dropdown.innerHTML = ""; // Ã–nce temizle

        // VarsayÄ±lan "Select Modem" SeÃ§eneÄŸi
        let defaultOption = document.createElement("option");
        defaultOption.value = "";
        defaultOption.disabled = true;
        defaultOption.selected = true;
        defaultOption.textContent = "Select Modem or Device";
        dropdown.appendChild(defaultOption);

        // Wi-Fi ve Modemlere BaÄŸlÄ± CihazlarÄ± Ekleyelim
        data.forEach((device) => {
          let option = document.createElement("option");
          option.value = device.ip;
          option.textContent = `${device.ip} (${device.mac})`;
          dropdown.appendChild(option);
        });
      })
      .catch((error) => console.error("CihazlarÄ± alÄ±rken hata:", error));
  }

  function connectDevice() {
    let dropdown = document.getElementById("modem");
    let selectedDevice = dropdown.value;

    if (!selectedDevice) {
      return;
    }

    fetch("/connect_device", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({ ip_address: selectedDevice }),
    })
      .then((response) => response.json())
      .then((data) => {
        let status = document.getElementById("status");
        if (data.success) {
          status.innerHTML = "<p style='color: green;'>BaÄŸlantÄ± baÅŸarÄ±lÄ±!</p>";
          sessionStorage.setItem("selected_device_ip", selectedDevice); // ğŸ“Œ Cihaz IP'sini sakla
        } else {
          status.innerHTML =
            "<p style='color: red;'>BaÄŸlantÄ± hatasÄ±: " + data.error + "</p>";
        }
      })
      .catch((error) => console.error("BaÄŸlantÄ± hatasÄ±:", error));
  }

  function goToORCStatus() {
    fetch("/get_selected_device")
      .then((response) => response.json())
      .then((data) => {
        if (!data.ip_address) {
          alert("LÃ¼tfen Ã¶nce bir cihaz seÃ§in!");
          return;
        }
        window.location.href = `/orc-status?ip_address=${data.ip_address}`;
      })
      .catch((error) => console.error("Cihaz seÃ§me hatasÄ±:", error));
  }

  // Sayfa yÃ¼klendiÄŸinde cihazlarÄ± getir
  document.addEventListener("DOMContentLoaded", fetchDevices);


  // Dashboard SAyfasÄ±na YÃ¶nlendirir
  function goToDashboard() {
    window.location.href = "/dashboard";
  }
</script>
{% endblock %}
