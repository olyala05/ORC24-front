{% extends "layout.html" %} {% block title %} Live Data Details {% endblock %}
{% block content %}

<!-- Header -->
{% include 'partials/header.html' %}

<div class="live-data-container">
  <!-- Live Data Table Bölümü -->
  <div class="live-data-table">
    <div class="table-header">
      <div>Created Date</div>
      <div>Number of Equipment</div>
      <div>Number of Data</div>
      <div>Time (Sec)</div>
    </div>
    <div id="live-data-container"></div>
  </div>

  <!-- Live Data Status Bölümü -->
  <div class="live-data-status">
    <div class="table-header">
      <div>Serial Number</div>
      <div>Status / Config.</div>
      <div>Equipment Type</div>
      <div>Archive</div>
      <div>Number of Data</div>

    </div>
    <div class="table-row clickable">
      <div data-serial="EMR-53CS@3630748023">EMR-53CS@3630748023</div>
      <!-- Status hücresine data-status ekleniyor -->
      <div data-status="A / A">A / A</div>
      <div>Analyzer</div>
      <div><span class="status inactive"></span></div>
      <div>200</div>
    </div>
    <div class="table-row clickable">
      <div data-serial="MPR-46S@2931" class="passive-style">MPR-46S@2931</div>
      <!-- Eğer status P/P ise; metin kırmızı olacak -->
      <div data-status="P / P">P / P</div>
      <div>Analyzer</div>
      <div><span class="status active"></span></div>
      <div>200</div>
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    fetchLiveData();
  });

  function fetchLiveData() {
    fetch("/fetch_grouped_live_data", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
    })
      .then((response) => response.json())
      .then((data) => {
        if (data.equipments) {
          updateLiveDataTable(data.equipments);
        } else {
          console.error("Veri alınamadı:", data.message || data.error);
        }
      })
      .catch((error) => console.error("Hata:", error));
  }

  function formatDateTime(dateTimeString) {
    const date = new Date(dateTimeString);
    return (
      date.toISOString().split("T")[0] + " " + date.toTimeString().split(" ")[0]
    );
  }

  function updateLiveDataTable(liveData) {
    const container = document.getElementById("live-data-container");
    container.innerHTML = ""; // Önceki verileri temizle

    liveData.forEach((item, index) => {
      const formattedDate = formatDateTime(item.created_at);

      const row = document.createElement("div");
      row.className = "table-row";
      row.innerHTML = `
          <div>${formattedDate}</div>
          <div>${item.equipment_count}</div>
          <div>${item.data_count}</div>
          <div>0</div>
      `;
      container.appendChild(row);
    });
  }

  document.addEventListener("DOMContentLoaded", function () {
    const clickableElements = document.querySelectorAll(".clickable");
    clickableElements.forEach(function (elem) {
      elem.addEventListener("click", function () {
        window.location.href = "/live-data-detail";
      });
    });
  });
</script>

{% endblock %}
