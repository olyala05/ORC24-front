{% extends "layout.html" %} {% block title %} Live Data Details {% endblock %}
{% block content %}

<!-- Header -->
{% include 'partials/header.html' %}

<div class="live-data-detail-table-container">
  <table class="live-data-detail-data-table">
    <thead>
      <tr>
        <th>Serial Number</th>
        <th>Modem Serial No</th>
        <th>Status / Configuration</th>
        <th>Archive</th>
        <th>Number of Data</th>
      </tr>
    </thead>
    <tbody id="equipment-details"></tbody>
  </table>

  <table class="live-data-detail-data-table">
    <thead>
      <tr>
        <th>Live Data ID</th>
        <th>Device ID</th>
        <th>Value List ID</th>
        <th>Data Value</th>
        <th>Created Date</th>
        <th>Main Value List</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>272003</td>
        <td>5</td>
        <td>804</td>
        <td>229.64</td>
        <td>2024-04-03 13:50:00</td>
        <td>3</td>
      </tr>
      <tr>
        <td>271856</td>
        <td>5</td>
        <td>21</td>
        <td>0.00</td>
        <td>2024-04-03 13:50:00</td>
        <td>8</td>
      </tr>
      <tr>
        <td>271856</td>
        <td>5</td>
        <td>21</td>
        <td>0.00</td>
        <td>2024-04-03 13:50:00</td>
        <td>8</td>
      </tr>
      <tr>
        <td>271856</td>
        <td>5</td>
        <td>21</td>
        <td>0.00</td>
        <td>2024-04-03 13:50:00</td>
        <td>8</td>
      </tr>
      <tr>
        <td>271856</td>
        <td>5</td>
        <td>21</td>
        <td>0.00</td>
        <td>2024-04-03 13:50:00</td>
        <td>8</td>
      </tr>
      <tr>
        <td>271856</td>
        <td>5</td>
        <td>21</td>
        <td>0.00</td>
        <td>2024-04-03 13:50:00</td>
        <td>8</td>
      </tr>
      <tr class="live-data-detail-error">
        <td>412</td>
        <td colspan="5">
          Retrieve the active register of the relevant equipment from the
          register list table and compare it with the log.
          <br />
          <span class="live-data-detail-error-text"
            >Make the value red if it's missing.</span
          >
        </td>
      </tr>

      <tr>
        <td>271856</td>
        <td>5</td>
        <td>21</td>
        <td>0.00</td>
        <td>2024-04-03 13:50:00</td>
        <td>8</td>
      </tr>

      <tr>
        <td>271856</td>
        <td>5</td>
        <td>21</td>
        <td>0.00</td>
        <td>2024-04-03 13:50:00</td>
        <td>8</td>
      </tr>

      <tr>
        <td>271856</td>
        <td>5</td>
        <td>21</td>
        <td>0.00</td>
        <td>2024-04-03 13:50:00</td>
        <td>8</td>
      </tr>
      <tr>
        <td>271856</td>
        <td>5</td>
        <td>21</td>
        <td>0.00</td>
        <td>2024-04-03 13:50:00</td>
        <td>8</td>
      </tr>
      <tr>
        <td>271856</td>
        <td>5</td>
        <td>21</td>
        <td>0.00</td>
        <td>2024-04-03 13:50:00</td>
        <td>8</td>
      </tr>
      <tr>
        <td>271856</td>
        <td>5</td>
        <td>21</td>
        <td>0.00</td>
        <td>2024-04-03 13:50:00</td>
        <td>8</td>
      </tr>
      <tr>
        <td>271856</td>
        <td>5</td>
        <td>21</td>
        <td>0.00</td>
        <td>2024-04-03 13:50:00</td>
        <td>8</td>
      </tr>
      <tr>
        <td>271856</td>
        <td>5</td>
        <td>21</td>
        <td>0.00</td>
        <td>2024-04-03 13:50:00</td>
        <td>8</td>
      </tr>
    </tbody>
  </table>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    fetchEquipmentDetails();
});

function fetchEquipmentDetails() {
    const selectedEquipmentID = sessionStorage.getItem("selected_equipment_id");

    if (!selectedEquipmentID) {
        console.error("‚ùå Ekipman se√ßilmedi!");
        document.getElementById("equipment-details").innerHTML =
            "<tr><td colspan='5' style='color: red; text-align: center;'>Ekipman se√ßilmedi!</td></tr>";
        return;
    }

    console.log("üîç Se√ßilen Equipment ID:", selectedEquipmentID);

    fetch(`/fetch_equipment_details?equipment_id=${selectedEquipmentID}`)  
      .then((response) => {
        if (!response.ok) {
          throw new Error(`HTTP Hatasƒ±! Status: ${response.status}`);
        }
        return response.json();
      })
      .then((data) => {
        console.log("‚úÖ Equipment Details Response:", data);

        if (data.status === "success" && data.data) {
          updateDetailsTable([data.data]);  
        } else {
          console.warn("‚ö†Ô∏è Ekipman detaylarƒ± bulunamadƒ±.");
          document.getElementById("equipment-details").innerHTML =
            "<tr><td colspan='5' style='color: red; text-align: center;'>Ekipman detaylarƒ± bulunamadƒ±.</td></tr>";
        }
      })
      .catch((error) => {
        console.error("‚ùå Detaylarƒ± getirirken hata olu≈ütu:", error);
        document.getElementById("equipment-details").innerHTML =
          "<tr><td colspan='5' style='color: red; text-align: center;'>Hata olu≈ütu.</td></tr>";
      });
}

  function updateDetailsTable(equipments) {
    const tableBody = document.getElementById("equipment-details");

    if (!tableBody) {
      console.error("Hata: `equipment-details` ID'li element bulunamadƒ±.");
      return;
    }

    tableBody.innerHTML = "";

    equipments.forEach((equipment) => {
      let row = document.createElement("tr");
      row.innerHTML = `
          <td>${equipment.model_name}@${equipment.serial_number}</td>
          <td>${equipment.modem_serial_number || "N/A"}</td>
          <td class="live-data-detail-status">${
            equipment.status === 1 ? "A / A" : "P / P"
          }</td>
          <td class="live-data-detail-archive">&#128308;</td>
          <td>${equipment.data_count || 0}</td>
      `;
      tableBody.appendChild(row);
    });
  }
</script>
{% endblock %}
