{% extends "layout.html" %}
{% block title %} Equipment Details {% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/equipment.css') }}" />
{% endblock %}

{% block content %}

<!-- Header -->
{% include 'partials/header.html' %}

<div class="equipment-container-wrapper">
  <div class="equipment-grid" id="equipment-list">
    <!-- Buraya dinamik veriler gelecek -->
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    let equipmentList = document.getElementById("equipment-list");

    let equipmentData = JSON.parse(sessionStorage.getItem("equipment_data")) || [];

    if (equipmentData.length === 0) {
        equipmentList.innerHTML = "<p style='color: red;'>Ekipman verisi bulunamadı.</p>";
        return;
    }

    equipmentData.forEach(equipment => {
        let statusClass = equipment.status === "A" ? "green" : "red";
        let equipmentBox = document.createElement("div");
        equipmentBox.className = `equipment-box ${statusClass}`;
        equipmentBox.innerHTML = `${equipment.model_name}`;

        equipmentBox.addEventListener("click", function() {
            let selectedDeviceIP = sessionStorage.getItem("selected_device_ip"); 

            if (!selectedDeviceIP) {
                Swal.fire({
                    icon: "warning",
                    title: "Uyarı",
                    text: "Lütfen önce bir cihaz seçiniz!",
                    confirmButtonText: "Tamam",
                });
                return;
            }
            sessionStorage.setItem("selected_equipment_id", equipment.id);

            fetch("/set_selected_equipment", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ equipment_id: equipment.id })
            }).then(() => {
                window.location.href = "/equipment-details";
            });
        });

        equipmentList.appendChild(equipmentBox);
    });
});
</script>

{% endblock %}
