{% extends "layout.html" %} 

{% block title %} {{ _('Network Alarms')}} {% endblock %} 

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/alarm.css') }}"/>
{% endblock %}

{% block content %}
<!-- Header -->
{% include 'partials/header.html' %}

<div class="alarm-network-container">
  <div class="alarm-network-table">
    <table>
      <thead>
        <tr>
          <th>{{ _('Name')}}</th>
          <th>{{ _('Modem Name')}}</th>
          <th>{{ _('Start Date')}}</th>
          <th>{{ _('End Date')}}</th>
        </tr>
      </thead>
      <tbody id="networkAlarmsTable">
        <tr><td colspan="4" style="text-align: center;">{{ _('Loading...')}}</td></tr>
      </tbody>
    </table>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    fetch("/get_network_alarm_data")
      .then(response => response.json())
      .then(data => {
        let tableBody = document.getElementById("networkAlarmsTable");
        tableBody.innerHTML = "";

        if (data.status === "success") {
          data.data.forEach(alarm => {
            let row = `<tr>
              <td class="highlight">${alarm.alarm_title}</td>
              <td class="highlight">${alarm.serial_number}</td>
              <td>${formatDate(alarm.start_at)}</td>
              <td>${formatDate(alarm.end_at)}</td>
            </tr>`;
            tableBody.innerHTML += row;
          });
        } else {
          tableBody.innerHTML = `<tr><td colspan="4" style="text-align: center; color: red;">{{ _('Data Retrieval Error:')}} ${data.message}</td></tr>`;
        }
      })
      .catch(error => {
        document.getElementById("networkAlarmsTable").innerHTML = `<tr><td colspan="4" style="text-align: center; color: red;">{{ _('Unable to connect to the server!')}}</td></tr>`;
      });
  });

  function formatDate(dateString) {
    return dateString ? new Date(dateString).toLocaleString("tr-TR") : "N/A";
  }
</script>


<style>
  .highlight {
    color: #EF742A;
  }
</style>

{% endblock %}
